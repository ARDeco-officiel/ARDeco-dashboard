<html lang="en">
<head>
  <meta charSet="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ARDeco Catalog</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css">
  <style>

    ::-webkit-scrollbar {
      width: 7px;
    }

    ::-webkit-scrollbar-track {
      background: rgba(241, 241, 241, 0.0);
    }

    ::-webkit-scrollbar-thumb {
      background: #6A7482;
      border-radius: 5px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: #58616c;
    }


    body {
      font-family: Arial, sans-serif;
      background-color: #f5f5f5;
      margin: 0;
      padding: 0;
    }

    header {
      background-color: #526ce3;
      color: white;
      padding: 20px;
      text-align: center;
    }

    main {
      display: grid;
      grid-template-columns: 1fr 1.5fr 1.5fr;
      grid-template-rows: auto auto;
      gap: 20px;
      padding: 20px;
    }

    .card {
      background-color: white;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .full-height {
      grid-row: 1 / -1;
    }

    main > :nth-child(4) {
      grid-column: 2 / span 2;
      grid-row: 2;
    }

    .full-height {
      height: 90vh;
      width: 45vh;
    }

    .full-height2 {
      grid-row: 1 / -1;
    }

    .full-height2 {
      height: 90.5vh;
      width: 70vw;
    }

    #open-tickets-list li:last-child {
      border-bottom: none;
    }

    #categories {
      padding: 0;
      list-style-type: none;
      margin: 20px;
    }

    #categories li {
      margin-bottom: 15px;
      padding: 10px 15px;
      color: #6A7482;
      font-weight: bold;
    }

    #categories li.selected {
      background: #ECFFFE;
      color: #6A7482;
      box-shadow: 0 2px 4px rgba(151, 189, 189, 0.79);
    }

    a {
      text-decoration: none;
      color: #6A7482;
    }



    ul {
      list-style-type: none;
    }

    #answer:focus {
      border-color: #1BCFC4;
    }

    button {
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
      transition: background-color 0.3s ease;
    }

    .line {
      width: 100%;
      height: 1px;
      background: #e1e9f5;
      margin: 20px 0;
    }

    #theme-toggle {
      background-color: #fff;
      color: #000;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
    }

    .dark-mode {
      background: #18202D;
      color: white;
    }

    .light-mode {
      background-color: #f5f5f5;
      color: black;
    }

    .dark-mode .card {
      background-color: #1F2734;
    }

    .light-mode .card {
      background-color: white;
    }

    .dark-mode #categories li.selected {
      background-color: #18202D;
      color: white;
      box-shadow: none;
    }

    .dark-mode #open-tickets-list li {
      background-color: #18202D;
      box-shadow: none;
    }

    .dark-mode #open-tickets-list li a {
      color: white;
    }

    .icon {
      color: #1BCFC4;
      background: #ffffff;
    }

    .iselected {
      color: #ffffff;
      background: #1BCFC4;
    }

    .dark-mode .icon {
      color: #1F2734;
      background: #1BCFC4;
    }

    #mode-toggle {
      margin-top: 20%;
      margin-left: 32%;
      background-color: #9E58FF;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
      transition: background-color 0.3s ease;
    }

    #mode-toggle:hover {
      background-color: #4d2c7c;
    }

    input[type="text"] {
      width: 100%;
      padding: 10px;
      margin: 5px 0;
      box-sizing: border-box;
    }

    #catalog {
      padding-right: 20px;
      list-style-type: none;
      margin: 20px;
      overflow: auto;
      max-height: 75vh;
    }

    .product {
      display: grid;
      grid-template-columns: minmax(80px, auto) minmax(150px, 1fr) 100px repeat(3, minmax(120px, 1fr)) minmax(150px, 1.5fr) 100px 100px;
      gap: 10px;
      align-items: center;
      padding: 10px;
      margin-bottom: 10px;
      border: 1px solid #ccc;
    }

    .product p {
      margin: 0;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .product button {
      justify-self: center;
    }.filter-popup {
       display: none;
       position: fixed;
       z-index: 1;
       left: 0;
       top: 0;
       width: 100%;
       height: 100%;
       overflow: auto;
       background-color: rgba(0,0,0,0.4);
     }
    .filter-popup-content {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: #fefefe;
      padding: 20px;
      border: 1px solid #888;
      width: 40%;
      border-radius: 10px;
    }
    .close {
      color: #aaaaaa;
      float: right;
      font-size: 28px;
      font-weight: bold;
    }
    .close:hover,
    .close:focus {
      color: #000;
      text-decoration: none;
      cursor: pointer;
    }
    .filter-group label,
    .filter-group input {
      display: block;
      margin: 5px 0;
    }

    .filter-group {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      margin-bottom: 20px;
    }

    .filter-group h4 {
      flex-basis: 100%;
      color: #526ce3;
      margin-bottom: 5px;
    }

    .filter-group div {
      background: #f5f5f5;
      border-radius: 5px;
      padding: 10px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }

    .filter-group input[type="checkbox"] {
      margin-right: 5px;
    }

    .filter-group label {
      margin: 0;
      color: #333;
      font-weight: normal;
    }

    .dark-mode .filter-group div {
      background: #1F2734;
      color: white;
    }

    .dark-mode .filter-group label {
      color: #ccc;
    }

    .dark-mode .filter-popup-content {
      background-color: #1F2734;
      color: white;
    }

    #filter-btn {
      margin-left: 67px;
    }

    .checkbox-group {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 15px;
    }

    .checkbox-item {
      background-color: #f0f0f0;
      padding: 5px 10px;
      border-radius: 5px;
      cursor: pointer;
      user-select: none;
    }

    .checkbox-item.selected {
      background-color: #1BCFC4;
      color: white;
    }

  </style>
</head>
<body>
<main>
  <section class="card full-height">
    <h2>ARDeco Administration tool</h2>
    <div class="line"></div>
    <ul id="categories">
      <li><a href="/dashboard"><i class="fa-solid fa-ticket icon"
                                  style="border-radius: 9px; padding: 10px; margin-right: 3px;"></i>
        Tickets
      </a></li>
      <li><a href="/users"><i class="fa-solid fa-user icon"
                                               style="border-radius: 9px; padding: 10px; margin-right: 3px;"></i>
        User</a></li>
      <li class="selected"><a href="/catalog"><i class="fa-solid fa-book icon iselected"
             style="border-radius: 9px; padding: 10px; margin-right: 3px;"></i> Catalog
        </a>
      </li>
      <li><a href="/statistics"><i class="fa-solid fa-chart-simple icon"
             style="border-radius: 9px; padding: 10px;margin-right: 3px;"></i> Statistics
        </a>
      </li>
      <li><a href="/changelog"><i class="fa-solid fa-clipboard-list icon"
             style="border-radius: 9px; padding: 10px; margin-right: 3px;"></i> Changelog
        </a>
      </li>
      <li><a href="/suggestions"><i class="fa-solid fa-list-ul icon"
             style="border-radius: 9px; padding: 10px; margin-right: 3px;"></i> Suggestions
        </a>
      </li>
    </ul>
    <div class="line"></div>
    <div style="background: #1BCFC4; height: 20%; width: 80%; border-radius: 15px; color: white; padding: 10%">
      <h1>New categories may arrive in a future update of the admin dashboard</h1>
    </div>
    <button id="mode-toggle">Theme switch</button>
  </section>
  <div id="catalogCard" class="card full-height2">
    <button id="filter-btn"><i class="fa-solid fa-filter"></i> Filters</button>
    <section class="full-height2">
      <ul id="catalog"></ul>
    </section>
  </div>
  <div id="filter-popup" class="filter-popup">
    <div class="filter-popup-content">
      <span class="close">&times;</span>
      <div class="filter-group" style="display: flex; flex-direction: row;">
        <h4>Style</h4>
        <div><input type="checkbox" name="style" value="modern" id="style-moderne"><label for="style-moderne">modern</label></div>
        <div><input type="checkbox" name="style" value="classic" id="style-classique"><label for="style-classique">classic</label></div>
        <div><input type="checkbox" name="style" value="vintage" id="style-vintage"><label for="style-vintage">vintage</label></div>
      </div>
      <div class="filter-group" style="display: flex; flex-direction: row;">
        <h4>Couleur</h4>
        <div><input type="checkbox" name="color" value="red" id="color-rouge"><label for="color-rouge">red</label></div>
        <div><input type="checkbox" name="color" value="blue" id="color-bleu"><label for="color-bleu">blue</label></div>
        <div><input type="checkbox" name="color" value="green" id="color-vert"><label for="color-vert">green</label></div>
        <div><input type="checkbox" name="color" value="yellow" id="color-jaune"><label for="color-jaune">yellow</label></div>
        <div><input type="checkbox" name="color" value="black" id="color-noir"><label for="color-noir">black</label></div>
      </div>
      <div class="filter-group" style="display: flex; flex-direction: row;">
        <h4>Compagnie</h4>
        <div><input type="checkbox" name="company" value="IKEA" id="company-ikea"><label for="company-ikea">IKEA</label></div>
        <div><input type="checkbox" name="company" value="maison du monde" id="company-habitat"><label for="company-habitat">Maison du monde</label></div>
      </div>
      <div class="filter-group" style="display: flex; flex-direction: row;">
        <h4>Pièce</h4>
        <div><input type="checkbox" name="room" value="Kitchen" id="room-cuisine"><label for="room-cuisine">kitchen</label></div>
        <div><input type="checkbox" name="room" value="Living room" id="room-salon"><label for="room-salon">living room</label></div>
        <div><input type="checkbox" name="room" value="Bedroom" id="room-chambre"><label for="room-chambre">bedroom</label></div>
      </div>
      <div class="filter-group" style="display: flex; flex-direction: row;">
        <h4>Prix Max</h4>
        <input type="range" id="price-range" name="price" min="0" max="1000" value="500" oninput="this.nextElementSibling.value = this.value">
        <output>500</output>€
      </div>
      <button onclick="filterCatalog()">Appliquer les Filtres</button>
    </div>
  </div>
  <div class="filter-popup" id="edit-popup">
    <div class="filter-popup-content">
      <span class="close" >&times;</span>
      <h2>Modifier le produit</h2>
      <form id="edit-form">
        <label for="edit-name">Nom :</label>
        <input type="text" id="edit-name" name="name" placeholder="Nom">

        <label for="edit-price">Prix :</label>
        <input type="text" id="edit-price" name="price" placeholder="Prix">

        <label>Styles :</label>
        <div id="edit-styles" class="checkbox-group"></div>

        <label>Pièces :</label>
        <div id="edit-rooms" class="checkbox-group"></div>

        <label>Couleurs :</label>
        <div id="edit-colors" class="checkbox-group"></div>

        <button type="button" onclick="sendEditedProduct()">Modifier</button>
      </form>
    </div>
  </div>


</main>
</body>
<script>
  let filterPopup = document.getElementById("filter-popup");
  let editPopup = document.getElementById("edit-popup");
  let btn = document.getElementById("filter-btn");
  let span = document.getElementsByClassName("close")[0];
  let span2 = document.getElementsByClassName("close")[1];

  let idEdit = 0;
  let companyEdit = 0;

  if (localStorage.getItem('mode') === 'dark') {
    document.body.classList.add('dark-mode');
  }

  document.getElementById('mode-toggle').addEventListener('click', function () {
    document.body.classList.toggle('dark-mode');
    if (document.body.classList.contains('dark-mode')) {
      localStorage.setItem('mode', 'dark');
    } else {
      localStorage.setItem('mode', 'light');
    }
  });

  getCatalog();

  function getCatalog() {
    fetch(`https://api.ardeco.app/catalog`, {
      method: 'GET',
      credentials: "include",
      headers: {
        'Content-Type': 'application/json'
      },
    }).then(function (response) {
      return response.json();
    }).then(function (data) {
      console.log(data);
      if (data.status === 'OK') {
        const catalog = document.getElementById('catalog');
        data.data.forEach(product => {
          const productDiv = document.createElement('li');
          productDiv.classList.add('product');
          productDiv.innerHTML = `
            <p>${product.id}</p>
            <p>${product.name}</p>
            <p>${product.price}</p>
            <p>${product.styles}</p>
            <p>${product.rooms}</p>
            <p>${product.colors}</p>
            <p>${product.company}: ${product.company_name}</p>
            <button style="background-color: #1BCFC4; color: white;" onclick='openEditProduct(${product.id}, ${product.company}, "${product.name.replace(/"/g, "&quot;")}", ${product.price}, "${product.styles.replace(/"/g, "&quot;")}", "${product.rooms.replace(/"/g, "&quot;")}", "${product.colors.replace(/"/g, "&quot;")}")'>Edit</button>
            <button style="background-color: #FF4D4D; color: white;">Delete</button>
          `;
          catalog.appendChild(productDiv);
        });
      }
    }).catch(error => {
      console.error(error);
    });
  }

  function filterCatalog() {
    const style = Array.from(document.querySelectorAll('input[name="style"]:checked')).map(checkbox => checkbox.value.toLowerCase());
    const color = Array.from(document.querySelectorAll('input[name="color"]:checked')).map(checkbox => checkbox.value.toLowerCase());
    const company = Array.from(document.querySelectorAll('input[name="company"]:checked')).map(checkbox => checkbox.value.toLowerCase());
    const room = Array.from(document.querySelectorAll('input[name="room"]:checked')).map(checkbox => checkbox.value.toLowerCase());
    const price = document.getElementById('price-range').value;
    const catalog = document.getElementById('catalog');
    const products = catalog.querySelectorAll('.product');

    products.forEach(product => {
      const productStyles = product.children[3].innerText.split(',').map(style => style.trim().toLowerCase());
      const productColors = product.children[5].innerText.split(',').map(color => color.trim().toLowerCase());
      const productCompanies = product.children[6].innerText.split(',').map(company => company.trim().toLowerCase());
      const productRooms = product.children[4].innerText.split(',').map(room => room.trim().toLowerCase());
      const productPrice = product.children[2].innerText;

      const styleMatch = style.length === 0 || style.some(s => productStyles.includes(s));
      const colorMatch = color.length === 0 || color.some(c => productColors.includes(c));
      const companyMatch = company.length === 0 || company.some(c => productCompanies.includes(c));
      const roomMatch = room.length === 0 || room.some(r => productRooms.includes(r));
      const priceMatch = price === '' || productPrice <= price;

      if (styleMatch && colorMatch && companyMatch && roomMatch && priceMatch) {
        product.style.display = 'grid';
      } else {
        product.style.display = 'none';
      }
    });
  }

  btn.onclick = function() {
    filterPopup.style.display = "block";
  }

  span.onclick = function() {
    filterPopup.style.display = "none";
  }

    span2.onclick = function() {
        editPopup.style.display = "none";
    }

  window.onclick = function(event) {
    if (event.target === filterPopup) {
      filterPopup.style.display = "none";
    }
  }

  function fetchStyles() {
    return ['Moderne', 'Classique', 'Industriel', 'Scandinave'];
  }

  function fetchRoomTypes() {
    return ['Salon', 'Chambre', 'Cuisine', 'Salle de bain'];
  }

  function fetchColors() {
    return ['Blanc', 'Noir', 'Gris', 'Beige', 'Bleu'];
  }

  function createCheckboxGroup(containerId, options) {
    const container = document.getElementById(containerId);
    options.forEach(option => {
      const item = document.createElement('div');
      item.classList.add('checkbox-item');
      item.textContent = option;
      item.onclick = function() {
        this.classList.toggle('selected');
      };
      container.appendChild(item);
    });
  }

  createCheckboxGroup('edit-styles', fetchStyles());
  createCheckboxGroup('edit-rooms', fetchRoomTypes());
  createCheckboxGroup('edit-colors', fetchColors());

  function openEditProduct(id, company, name, price, styles, rooms, colors) {
    editPopup.style.display = "block";

    document.getElementById('edit-name').value = name;
    document.getElementById('edit-price').value = price;

    selectCheckboxItems('edit-styles', styles.split(',').map(s => s.trim()));
    selectCheckboxItems('edit-rooms', rooms.split(',').map(r => r.trim()));
    selectCheckboxItems('edit-colors', colors.split(',').map(c => c.trim()));

    idEdit = id;
    companyEdit = company;
  }

  function selectCheckboxItems(containerId, values) {
    const container = document.getElementById(containerId);
    container.querySelectorAll('.checkbox-item').forEach(item => {
      item.classList.toggle('selected', values.includes(item.textContent));
    });
  }

  function sendEditedProduct() {
    const name = document.getElementById('edit-name').value;
    const price = document.getElementById('edit-price').value;
    const styles = getSelectedCheckboxValues('edit-styles');
    const rooms = getSelectedCheckboxValues('edit-rooms');
    const colors = getSelectedCheckboxValues('edit-colors');

    fetch(`https://api.ardeco.app/catalog/${companyEdit}/edit/${idEdit}`, {
      method: 'PUT',
      credentials: "include",
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        name: name,
        price: price,
        styles: styles.join(','),
        rooms: rooms.join(','),
        colors: colors.join(',')
      })
    }).then(function (response) {
      return response.json();
    }).then(function (data) {
      console.log(data);
      if (data.status === 'OK') {
        editPopup.style.display = "none";
        updateProductInCatalog(idEdit, name, price, styles, rooms, colors);
      }
    }).catch(error => {
      console.error(error);
    });
  }

  function getSelectedCheckboxValues(containerId) {
    const container = document.getElementById(containerId);
    return Array.from(container.querySelectorAll('.checkbox-item.selected')).map(item => item.textContent);
  }

  function updateProductInCatalog(id, name, price, styles, rooms, colors) {
    const productDiv = document.querySelector(`#catalog li:nth-child(${id})`);
    if (productDiv) {
      productDiv.children[1].innerText = name;
      productDiv.children[2].innerText = price;
      productDiv.children[3].innerText = styles.join(',');
      productDiv.children[4].innerText = rooms.join(',');
      productDiv.children[5].innerText = colors.join(',');
    }
  }
</script>
</html>